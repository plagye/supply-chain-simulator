# Supply Chain Simulator (10-Drone + Live API)

This branch is the **active direction**: **10 drone products** (D-101..D-303), **10 shared parts** (P-001..P-010), **4 suppliers**, **15 customers**, and a **minimal live API** so you can call and get current values (inventory, status, backorders, deliveries). The previous single-product (DRONE-X1) setup on `main` is deprecated for this scenario.

---

## Data Model

- **Parts (10):** P-001..P-010 (Frame-Light/Heavy, Motor-Std/Pro, Propeller-Set, Battery-5Ah/10Ah, Flight-Controller, Nav-GPS, Payload-Interface). See `data/parts.json` after generate.
- **Products (10):** D-101..D-303 (Sparrow-S1/Pro, Falcon-X, Courier-M/L, Surveyor-300/500, Titan-Hauler, Agri-Sprayer, Sky-Crane). Generated by `scripts/generate_products.py`; see `data/products.json` after `python main.py generate`.
- **BOM:** Multi-product; each drone uses a subset of the 10 parts. `data/bom.json` has structure `{ "products": { "D-101": { "bom": [...] }, ... } }`.
- **Suppliers (4):** SUP-001 VoltStream Tech (China), SUP-002 CarbonFiber Works (Germany), SUP-003 LogicCore Systems (USA), SUP-004 OmniMount Solutions (USA).
- **Customers (15):** 4 segments (Retail, Logistics, Agriculture, Government); each has `destination_facility_id` and `delivery_location_code` for code-based delivery.
- **Facilities:** FAC-001 (SkyForge HQ, Chicago, `USA_CHI`) plus distribution facilities; routes are **CODE → CODE** (origin_location_code, destination_location_code).

---

## Quick Start

```bash
pip install -r requirements.txt
python main.py generate
python main.py simulate --ticks 720
```

---

## Commands

| Command | Description |
|--------|-------------|
| `python main.py generate [--seed 42]` | Generate all master data (suppliers, parts, BOM, facilities, routes, customers, inventory, production_schedule). |
| `python main.py simulate [--ticks 720] [--seed 42]` | Run simulation for a fixed number of hourly ticks. Events to date-partitioned JSONL in `data/events/`. |
| `python main.py all [--ticks 720] [--seed 42]` | Generate then simulate. |
| `python main.py generate-history --years 3 [--seed 42]` | Generate 1–3 years of history to `data/events/history.jsonl`. |
| `python main.py run-service [--tick-interval 5] [--resume\|--fresh]` | Run as continuous service; state to PostgreSQL; **live API** available (see below). |

---

## Live API (run-service only)

When you run `run-service`, a read-only HTTP API is started so you can **call and get current values**. How you display or use the data is up to you.

- **Base URL:** `http://<api_host>:<api_port>` (default: `http://127.0.0.1:8010`).
- **Config:** In `config.json`, under `run-service`: `api_host`, `api_port`, `api_enabled` (default: true).

### Endpoints

| Method | Path | Description |
|--------|------|-------------|
| GET | `/status` | Simulation status: `current_time`, `tick_count`, `running`. |
| GET | `/inventory` | All current inventory (parts + products). |
| GET | `/inventory/parts` | Only parts (P-001..P-010). |
| GET | `/inventory/products` | Only finished products (D-101..D-303). |
| GET | `/inventory/{id}` | Single item by part_id or product_id (404 if missing). |
| GET | `/backorders` | Pending backorders. |
| GET | `/deliveries` | Pending deliveries (loads in transit). |

### Example

```bash
curl http://127.0.0.1:8010/status
curl http://127.0.0.1:8010/inventory
curl http://127.0.0.1:8010/inventory/parts
curl http://127.0.0.1:8010/backorders
curl http://127.0.0.1:8010/deliveries
```

---

## Config

- **run-service:** `tick_interval`, `seed`, `api_host` (default 127.0.0.1), `api_port` (default 8010), `api_enabled` (default true).
- **simulate.engine / run-service.engine:** Demand, production, supplier, invoice, forecast, S&OP, promo, delivery, data_corruption, etc. See `config.json`.

---

## Output Files

- **Master data:** `data/suppliers.json`, `parts.json`, `products.json` (from `generate_products.py`), `bom.json`, `customers.json`, `facilities.json`, `routes.json`, `inventory.json`, `production_schedule.json`.
- **Events:** `simulate` and `run-service` write date-partitioned JSONL under `data/events/` (e.g. `YYYY-MM-DD.jsonl`). `generate-history` writes a single `data/events/history.jsonl`.
- **Corruption meta:** `data/events/_meta/corruption_meta_log.jsonl` (for ETL quarantine verification).

All event types (SalesOrderCreated, ShipmentCreated, LoadCreated, DeliveryEvent, InvoiceCreated, PaymentReceived, ProductionJob*, PurchaseOrder*, etc.) are unchanged; only IDs are now the new parts and products. See the project docs or event payloads for full list.

---

## Database (optional)

PostgreSQL is used by `run-service` for **resume** (current simulation time and tick count). Design your own schema and pipeline to load events from JSONL into your database. Use `.env` (see `.env.example`) for DB credentials.

---

## Branch Note

See `docs/BRANCH-NOTES.md`: this branch (`feature/live-api-and-drone-variants`) is the new direction; `main` is deprecated for active development of the 10-drone + live-API scenario.
